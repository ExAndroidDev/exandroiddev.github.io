<!DOCTYPE html>
<html lang="en" data-theme="dark-poole">
  <head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>
     Pentest tale - Dumping cleartext credentials from antivirus &middot; Ex Android Dev 
  </title>

  <link rel="stylesheet" href="/styles.css" />
  <link
    rel="apple-touch-icon-precomposed"
    sizes="144x144"
    href="/assets/apple-touch-icon-precomposed.png"
  />
  <link rel="shortcut icon" href="/assets/favicon.ico" />
  <link
    rel="alternate"
    type="application/atom+xml"
    title="Ex Android Dev"
    href="/atom.xml"
  />

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Pentest tale - Dumping cleartext credentials from antivirus" />
<meta name="author" content="ExAndroidDev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I have nothing “mind blown” to share, so let me tell you a story." />
<meta property="og:description" content="I have nothing “mind blown” to share, so let me tell you a story." />
<link rel="canonical" href="http://localhost:4000/2021/11/20/pentest-tale-dumping-cleartext-credentials-from-antivirus/" />
<meta property="og:url" content="http://localhost:4000/2021/11/20/pentest-tale-dumping-cleartext-credentials-from-antivirus/" />
<meta property="og:site_name" content="Ex Android Dev" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-20T00:00:00+01:00" />
<script type="application/ld+json">
{"description":"I have nothing “mind blown” to share, so let me tell you a story.","headline":"Pentest tale - Dumping cleartext credentials from antivirus","dateModified":"2021-11-20T00:00:00+01:00","datePublished":"2021-11-20T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021/11/20/pentest-tale-dumping-cleartext-credentials-from-antivirus/"},"author":{"@type":"Person","name":"ExAndroidDev"},"@type":"BlogPosting","url":"http://localhost:4000/2021/11/20/pentest-tale-dumping-cleartext-credentials-from-antivirus/","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body>
    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Ex Android Dev</a>

          <nav class="nav">
            
            <small><a href="/about">About</a></small>
            
          </nav>
        </h3>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Pentest tale - Dumping cleartext credentials from antivirus</h1>
  <time datetime="2021-11-20T00:00:00+01:00" class="post-date">20 Nov 2021</time>
  <p>I have nothing “mind blown” to share, so let me tell you a story.</p>

<p>On one of my past pentests, I was engaged to perform an internal penetration test of the network with an assumed breach scenario. I have had access to the machine as a regular employee would.</p>

<p>So, what is the first thing you would do? <br />
I have tried to run some enumeration scripts, but I haven’t been so careful and antivirus had been triggered. Very soon after, I have been informed by the blue team that my actions have been noticed and they provided me with the picture of antivirus sending them an alert email. That made me wonder, how did the antivirus send the email exactly?</p>

<p>The installed antivirus was ESET. I have started browsing around its settings and I have come across email notifications.</p>

<p><img src="/assets/eset-email-notification-settings.png" alt="esset-email-notification-settings" class="center-image" /></p>

<p>Basically, whenever ESET catches something, it sends an email notification.</p>

<p><img src="/assets/eset-email-notification.png" alt="esset-email-notification" class="center-image" /></p>

<p>Depending on the installation and permissions, you might not have an option to edit any settings in the antivirus. That was the case in my scenario, I had read-only permission.</p>

<p>I have tried various ways to read those credentials, among the other things, I have tried the ESET’s export function with the hope to export email credentials in cleartext.</p>

<p><img src="/assets/eset-export-settings.png" alt="eset-export-settings" class="center-image" /></p>

<p>Of course, the password was encrypted.
<img src="/assets/eset-export-settings-enc-pass.png" alt="eset-export-settings" class="center-image" /></p>

<p>Then it came to my mind, how can ESET send an email if credentials were encrypted? It uses an SMTP, of course it needs cleartext credentials to authenticate to the SMTP server.</p>

<p>So there were 2 possible routes from that point. 
Find the key and decrypt the credentials or dump the process memory and search for credentials. 
Guess which one I have chosen. Yes, I have chosen the lazy one.</p>

<p>I have used task manager, found the process and dumped its memory.
<img src="/assets/task-mgr-2.png" alt="task-mgr-2" class="center-image" /></p>

<p><img src="/assets/task-mgr-3.png" alt="task-mgr-3" class="center-image" /></p>

<p>A simple search for “SMTP_” through the dump file resulted in the cleartext credentials.</p>
<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>findstr SMTP_ &lt;dump_file&gt;
</code></pre></div></div>

<p><img src="/assets/findstr-cleartext-password.png" alt="findstr-cleartext-password" class="center-image" /></p>

<p>I wish I could tell you how credentials I have obtained were domain admin’s or how I managed to pwn the whole domain, but sadly that was not the case. I could only send an email as that user.</p>

<p>I hope you find this useful, and next time don’t forget to check your target’s antivirus configuration.</p>

<p>The end!</p>


  <br/>
  

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<div id="share-buttons">
    <div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/intent/tweet?text=&url=https://www.exandroid.dev/2021/11/20/pentest-tale-dumping-cleartext-credentials-from-antivirus/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://www.exandroid.dev/2021/11/20/pentest-tale-dumping-cleartext-credentials-from-antivirus/&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
</div>

</article>


      </main>

      <footer class="footer">
        <small>
          &copy;
          <time datetime="2022-03-14T15:28:29+01:00"
            >2022</time
          >. All rights reserved.
        </small>
      </footer>
    </div>

    
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "https://www.google-analytics.com/analytics.js",
        "ga"
      );
      ga("create", "UA-193334062-1", "auto");
      ga("send", "pageview");
    </script>
    
  </body>
</html>
